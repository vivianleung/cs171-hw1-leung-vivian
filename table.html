<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS171 Homework 1</title>
  <link href='http://fonts.googleapis.com/css?family=Alef' rel='stylesheet' type='text/css'>
  <link type="text/css" href="tablepage.css" rel="stylesheet">
</head>
<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        // parses tsv as text
        d3.text("unemp_states_us_nov_2013.tsv", function(text){

            // parses text as arrays per row of data, inclu headers
            var data = d3.tsv.parseRows(text);

            // isolates headers from parsed data (first item in array)
            var headers = data.shift();

            // main title for table
            var titles = 'Unemployment Rates For States <br> Monthly Rankings <br> Seasonally Adjusted <br> Dec. 2013P';

            // counts number of columns req'd (for colspan)
            var cols = headers.length;
   

            // head title for page
            var pagetitle = d3.select("body")
            .data(["Unemployment Rates For States"])
            .append("h1")
            .text(function(text) { return text; });


            // sets up table DOM
            var table = d3.select("body").append("table"),
                thead = table.append("thead"),
                tbody = table.append("tbody");

            // main title of table
            var tabletitle = table.append("caption")
            .html(titles);

            // column headers
            var i = 0;
            var colheads = thead.append("tr").selectAll("th")
                .data(headers)
                .enter()
                .append("th")
                .attr("class", function() { return "colhead" + i++; })
                .text(function(d) { return d; })

                // sorting mechanism
                .on("click", function(){
                    var sortcol = d3.select(this).attr("class").substring(7);
                    var rowcount = 0;
                    tbody.selectAll("tr")
                        .sort(function(a,b) {
                            return d3.ascending(a[sortcol], b[sortcol]);
                        })
                        .attr("class", function() {
                            return "row" + rowcount++; })
                        .style('background-color', function() {
                            return normalcolor(d3.select(this).attr("class")); })
                    d3.select(this)
                        .style("background-color", "#FF0066")
                        .style("color", "#FFFFFF")
                        .classed("ascending", function()
                            if (d3.select(this).classed("active", true)) { return false; }
                            else { return true; }
                        );

                });


            var rows = renderrows(tbody);
            var cells = rendercells(rows);

            // appends rows (from sample code)
            function renderrows(tbody){            
                var rowcount = 0;
                var rows = tbody.selectAll("tr")
                    .data(data)
                    .enter()
                    .append("tr")
                    .attr("class", function() {
                        return "row" + rowcount++; })
                    .style('background-color', function() {
                        console.log(d3.select(this).attr("class"));
                        return normalcolor(d3.select(this).attr("class")); })
                    
                    // highlighting / dehighlighting for mouseover
                    .on("mouseover", function() {
                        d3.select(this).style('background-color', "rgba(255, 204, 0, 0.5)");
                    })
                    .on("mouseout", function() {
                        d3.select(this).style('background-color', normalcolor(d3.select(this).attr("class")) )
                    });
                return rows;
            }

            function normalcolor(row){
                row = row.substring(3);
                if (row % 2 == 0) { return "#B2D9D9"; }
                else { return "#FFFFFF"; }
            }
            
            
            // appends cells for each row (from sample code)
            function rendercells(rows){
                var column = 0;
                var cells = rows.selectAll("td")
                    .data(function(row) {
                        return d3.range(cols)
                            .map(function(i) {
                                return row[ Object.keys(row)[i] ];
                        });
                    })
                    .enter()
                    .append("td")
                    .attr("class", function() {
                        if (column > cols - 1) { column = 0; }
                        return "col" + column++;
                    })
                    .text(function(d) { 
                        return d; })

                    // highlight column on mouseover
                    .on("mouseover", function(){
                        var hovercol = d3.select(this).attr("class")
                            .substring(3);
                        d3.selectAll("td.col" + hovercol)
                            .style('background-color', "rgba(255, 204, 0, 0.5)");
                    })

                    // remove highlight from column on mouseout
                    .on("mouseout", function() {
                        var hovercol = d3.select(this).attr("class")
                            .substring(3);
                        d3.selectAll("td.col" + hovercol)
                            .style('background-color', "inherit");
                });
            }
        });
        


    </script>
</body>
</html>
