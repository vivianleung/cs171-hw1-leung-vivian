<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS171 Homework 1</title>
  <link href='http://fonts.googleapis.com/css?family=Alef' rel='stylesheet' type='text/css'>
  <link type="text/css" href="tablepage.css" rel="stylesheet">
</head>
<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        // parses tsv as text
        d3.text("unemp_states_us_nov_2013.tsv", function(text){

            // parses text as arrays per row of data, inclu headers
            var data = d3.tsv.parseRows(text);

            // isolates headers from parsed data (first item in array)
            var headers = data.shift();

            // main title for table
            var titles = 'Unemployment Rates For States <br> Monthly Rankings <br> Seasonally Adjusted <br> Dec. 2013P';

            // counts number of columns req'd (for colspan)
            var cols = headers.length;
   

            // head title for page
            var pagetitle = d3.select("body")
            .data(["Unemployment Rates For States"])
            .append("h1")
            .text(function(text) { return text; });


            // sets up table DOM
            var table = d3.select("body").append("table"),
                thead = table.append("thead"),
                tbody = table.append("tbody");

            // main title of table
            var tabletitle = table.append("caption")
            .html(titles);

            // column headers
            var colheads = thead.append("tr").selectAll("th")
                .data(headers)
                .enter()
                .append("th")
                .attr("class", "colhead")
                .text(function(d) { return d; });

            // appends rows (from sample code)
            var rowcount = 0;
            var rows = tbody.selectAll("tr")
                .data(data)
                .enter()
                .append("tr")
                .attr("class", function() {
                    return "row" + rowcount++; })
                .style('background-color', function() {
                    return normalcolor(d3.select(this).attr("class")); })
                .on("mouseover", function() {
                    d3.select(this).style('background-color', "rgba(255, 204, 0, 0.5)");
                })
                .on("mouseout", function() {
                    d3.select(this).style('background-color', normalcolor(d3.select(this).attr("class")) )
                });

            function normalcolor(row){
                row = row.substring(3);
                if (row % 2 == 0) { return "#B2D9D9"; }
                else { return "#FFFFFF"; }
            }
            
            
            // appends cells for each row (from sample code)
            var column = 0;
            var cells = rows.selectAll("td")
                .data(function(row) {
                    return d3.range(cols)
                        .map(function(i) {
                            return row[ Object.keys(row)[i] ];
                    });
                })
                .enter()
                .append("td")
                .attr("class", function() {
                    if (column > cols - 1) { column = 0; }
                    return "col" + column++;
                })
                .text(function(d) { 
                    return d; })

                // highlight column on mouseover
                .on("mouseover", function(){
                    var selectedcol = d3.select(this).attr("class")
                        .substring(3);
                    d3.selectAll("td.col" + selectedcol)
                        .style('background-color', "rgba(255, 204, 0, 0.5)");
                })

                // remove highlight from column on mouseout
                .on("mouseout", function() {
                    var selectedcol = d3.select(this).attr("class")
                        .substring(3);
                    d3.selectAll("td.col" + selectedcol)
                        .style('background-color', "inherit");
            });
        });
        


    </script>
</body>
</html>
